<!DOCTYPE html>
<!--
iOS + Safari で動く、位置ずれ起きない版
ライブ配信は時雨堂さんのSoraを使わて頂いている
-->
<html>
  <head>
    <meta charset="utf-8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ウソ穴 iOS+Safari対応版</title>
  </head>
  <body style="margin:0px; overflow:hidden;">
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.js"></script>

    <a-assets>
      <img id="img1" src="invisible.png" />
      <video id="vid" width="100" height="100" autoplay loop muted poster="" playsinline crossorigin="anonymous" playsinline="" webkit-playsinline="" muted="muted"></video>
    </a-assets>

    <a-scene embedded arjs="debugUIEnabled:false;">
      <a-marker preset="hiro" position="" rotation="" scale="" visible="" material="" arjs-anchor="" arjs-hit-testing="">
        <a-box position=" 0.00 -1.50  0.00" wireframe="false" material="src: #vid" width="1.7" height="1.7" depth="1.7" rotation="" scale="" visible="" material="" geometry="" src=""></a-box>

        <a-box position=" 1.00 -1.00 -0.15" wireframe="false" color="#843233" width="0.3" height="2.0" depth="2.0" rotation="" scale="" visible="" material="" geometry="" src=""></a-box>
        <a-box position="-1.00 -1.00  0.15" wireframe="false" color="#0095DD" width="0.3" height="2.0" depth="2.0" rotation="" scale="" visible="" material="" geometry="" src=""></a-box>
        <a-box position="-0.15 -1.00 -1.00" wireframe="false" color="#7899aa" width="2.0" height="2.0" depth="0.3" rotation="" scale="" visible="" material="" geometry="" src=""></a-box>
        <a-box position=" 0.15 -1.00  1.00" wireframe="false" color="#333333" width="2.0" height="2.0" depth="0.3" rotation="" scale="" visible="" material="" geometry="" src=""></a-box>

        <a-box position=" 1.30 -1.00  0.00" wireframe="false" material="src: #img1" width="0.3" height="2.0" depth="2.3" rotation="" scale="" visible="" material="" geometry="" src=""></a-box>
        <a-box position="-1.30 -1.00  0.00" wireframe="false" material="src: #img1" width="0.3" height="2.0" depth="2.3" rotation="" scale="" visible="" material="" geometry="" src=""></a-box>
        <a-box position="-0.00 -1.00 -1.30" wireframe="false" material="src: #img1" width="2.3" height="2.0" depth="0.3" rotation="" scale="" visible="" material="" geometry="" src=""></a-box>
        <a-box position=" 0.00 -1.00  1.30" wireframe="false" material="src: #img1" width="2.3" height="2.0" depth="0.3" rotation="" scale="" visible="" material="" geometry="" src=""></a-box>
      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>

    <script>
      window.addEventListener('click', function () {
        var v = document.querySelector('#vid');
        v.play();
      });
    </script>

    <!--  -->
    <script type="text/javascript" src="./sora.min.js"></script>
    <script type="text/javascript">
    const channelId = '{github-ID}@sora-labo';
    const signalingUrl = 'wss://sora-labo.shiguredo.jp/signaling';
    const metadata = {"signaling_key": "{シグナリングキー}"};

    const debug = true;
    const sora = Sora.connection(signalingUrl, debug);
    let options = {
        audio: true,
        audioCodecType: 'OPUS',
        audioBitRate: 96,
        video: true,
        videoCodecType: 'H264',
        videoBitRate: 1500,
    }
    const subscriber = sora.subscriber(channelId, metadata, options);

    subscriber.connect()
              .then(stream => {
                  document.querySelector('#vid').srcObject = stream;
              })
              .catch(e => {
                  console.error(e);
              });
    </script>
    <!--  -->

  </body>
</html>
