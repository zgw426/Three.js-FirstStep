<!DOCTYPE html>
<!--
ウソ穴
時雨堂 sora を利用
Firefoxで動作
-->
<html class="">
  <head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="https://cdn.rawgit.com/Chalarangelo/mini.css/v3.0.1/dist/mini-default.min.css">
    <title>AR PeepHole</title>
  </head>
    <body style="margin: 0px 0px 0px 126.5px; overflow: hidden; width: 640px; height: 480px;" class="">

    <script src="https://aframe.io/releases/0.8.2/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/1.5.5/aframe/build/aframe-ar.js"></script>
    <script src="./hls-load-texture/hls.js@latest"></script>

    <a-scene embedded="" arjs="trackingMethod:best; debugUIEnabled:false;" class="" canvas="" inspector="" keyboard-shortcuts="" screenshot="" vr-mode-ui="">
        <a-assets>
          <img id="img1" src="invisible.png" />
          <video id="remote-video" width="100" height="100" autoplay="" loop="true" crossorigin="anonymous" playsinline="" webkit-playsinline="" muted="muted"></video>          
        </a-assets>

        <a-marker preset="hiro" position="" rotation="" scale="" visible="" material="" arjs-anchor="" arjs-hit-testing="">
          <a-entity geometry="primitive: box; width: 1.70; depth: 1.70;" material="src: #remote-video" position="0.00 -1.50 0.00" rotation="0 0 0"></a-entity>

          <a-box position=" 1.00 -1.00 -0.15" wireframe="false" color="#843233" width="0.3" height="2.0" depth="2.0" rotation="" scale="" visible="" material="" geometry="" src=""></a-box>
          <a-box position="-1.00 -1.00  0.15" wireframe="false" color="#0095DD" width="0.3" height="2.0" depth="2.0" rotation="" scale="" visible="" material="" geometry="" src=""></a-box>
          <a-box position="-0.15 -1.00 -1.00" wireframe="false" color="#7899aa" width="2.0" height="2.0" depth="0.3" rotation="" scale="" visible="" material="" geometry="" src=""></a-box>
          <a-box position=" 0.15 -1.00  1.00" wireframe="false" color="#333333" width="2.0" height="2.0" depth="0.3" rotation="" scale="" visible="" material="" geometry="" src=""></a-box>

          <a-box position=" 1.30 -1.00  0.00" wireframe="false" material="src: #img1" width="0.3" height="2.0" depth="2.3" rotation="" scale="" visible="" material="" geometry="" src=""></a-box>
          <a-box position="-1.30 -1.00  0.00" wireframe="false" material="src: #img1" width="0.3" height="2.0" depth="2.3" rotation="" scale="" visible="" material="" geometry="" src=""></a-box>
          <a-box position="-0.00 -1.00 -1.30" wireframe="false" material="src: #img1" width="2.3" height="2.0" depth="0.3" rotation="" scale="" visible="" material="" geometry="" src=""></a-box>
          <a-box position=" 0.00 -1.00  1.30" wireframe="false" material="src: #img1" width="2.3" height="2.0" depth="0.3" rotation="" scale="" visible="" material="" geometry="" src=""></a-box>

        </a-marker>

    <a-entity camera="" position="" rotation="" scale="" visible=""></a-entity>
    <canvas class="a-canvas" data-aframe-canvas="true" width="1120" height="840" style="width: 640px; height: 480px;"></canvas>
    <div class="a-enter-vr embedded" aframe-injected="" style="position: fixed;">
      <button class="a-enter-vr-button" aframe-injected=""></button>
    </div>
    <div class="a-orientation-modal a-hidden" aframe-injected="">
      <button aframe-injected="">Exit VR</button>
    </div>
    <a-entity light="" data-aframe-default-light="" aframe-injected="" position="" rotation="" scale="" visible=""></a-entity>
    <a-entity light="" position="" data-aframe-default-light="" aframe-injected="" rotation="" scale="" visible=""></a-entity>
  </a-scene>


<!-- ------------------- -->

<script type="text/javascript" src="./sora.min.js"></script>
<script type="text/javascript">
 const channelId = '{{githubアカウント}}@sora-labo';
 const signalingUrl = 'wss://sora-labo.shiguredo.jp/signaling';
 const metadata = {"signaling_key": "{{シグナリングキー}}"};

 const debug = true;
 const sora = Sora.connection(signalingUrl, debug);
 let options = {
     audio: true,
     audioCodecType: 'OPUS',
     audioBitRate: 96,
     video: true,
     videoCodecType: 'H264',
     videoBitRate: 1500,
 }
 const subscriber = sora.subscriber(channelId, metadata, options);

 subscriber.connect()
           .then(stream => {
               document.querySelector('#remote-video').srcObject = stream;
           })
           .catch(e => {
               console.error(e);
           });
</script>

</body>
</html>
